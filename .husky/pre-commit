#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ TRAIDER V1 Pre-commit Quality Gates"
echo "======================================"

# Run lint-staged for comprehensive checks
echo "ğŸ” Running lint-staged checks..."
npx lint-staged

# Check for console.log statements
echo "ğŸ” Checking for console.log statements..."
if git diff --cached --name-only | xargs grep -l "console\." 2>/dev/null; then
  echo "âŒ Console statements found! Remove before commit."
  exit 1
fi

# Check for .only in tests
echo "ğŸ” Checking for .only() in tests..."
if git diff --cached --name-only | xargs grep -l "\.only(" 2>/dev/null; then
  echo "âŒ Test .only() found! Remove before commit."
  exit 1
fi

# Check TypeScript compilation
echo "ğŸ” Checking TypeScript compilation..."
if git diff --cached --name-only | grep -E '\.(ts|tsx)$' > /dev/null; then
  echo "ğŸ“– TypeScript files changed, checking compilation..."
  npx tsc --noEmit
  if [ $? -ne 0 ]; then
    echo "âŒ TypeScript compilation failed!"
    exit 1
  fi
fi

# Validate documentation freshness
echo "ğŸ” Validating documentation..."
npm run docs:validate

# Check if documentation needs updating
if git diff --cached --name-only | grep -E '\.(ts|tsx)$' > /dev/null; then
  echo "ğŸ“– Checking JSDoc coverage..."
  npm run docs:coverage
fi

echo "âœ… All pre-commit checks passed!"
echo "ğŸ¯ Ready for institutional-grade commit!" 