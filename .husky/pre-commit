#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ðŸš€ TRAIDER V1 Pre-commit Quality Gates"
echo "======================================"

# Run comprehensive custom pre-commit checks
echo "ðŸ” Running comprehensive quality checks..."
npx tsx scripts/pre-commit-checks.ts

# If custom checks pass, run lint-staged
if [ $? -eq 0 ]; then
  echo ""
  echo "ðŸ” Running lint-staged checks..."
  npx lint-staged
else
  echo "âŒ Custom quality checks failed - aborting commit"
  exit 1
fi

# Check TypeScript compilation for changed files
if git diff --cached --name-only | grep -E '\.(ts|tsx)$' > /dev/null; then
  echo ""
  echo "ðŸ“– TypeScript files changed, checking compilation..."
  npx tsc --noEmit --incremental false
  if [ $? -ne 0 ]; then
    echo "âŒ TypeScript compilation failed!"
    exit 1
  fi
fi

# Validate documentation freshness
echo ""
echo "ðŸ“š Validating documentation..."
npm run docs:validate --silent

# Check JSDoc coverage for TypeScript changes
if git diff --cached --name-only | grep -E '\.(ts|tsx)$' > /dev/null; then
  echo "ðŸ“– Checking JSDoc coverage..."
  npm run docs:coverage --silent
fi

# Final success message
echo ""
echo "âœ… All pre-commit checks passed!"
echo "ðŸŽ¯ Ready for institutional-grade commit!"
echo "ðŸ“Š Commit will be processed with full audit trail" 